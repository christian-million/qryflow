<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Extending qryflow Functionality • qryflow</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extending qryflow Functionality">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">qryflow</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/qryflow.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/advanced-qryflow.html">Advanced Usage with qryflow</a></li>
    <li><a class="dropdown-item" href="../articles/extend-qryflow.html">Extending qryflow Functionality</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/christian-million/qryflow/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Extending qryflow Functionality</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/christian-million/qryflow/blob/main/vignettes/extend-qryflow.Rmd" class="external-link"><code>vignettes/extend-qryflow.Rmd</code></a></small>
      <div class="d-none name"><code>extend-qryflow.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://christian-million.github.io/qryflow/">qryflow</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p><code>qryflow</code> was designed to be easily extended and allows
users to define custom chunk types. This vignette provides relevant
background knowledge on how <code>qryflow</code> works under the hood,
then walks through how to create and register custom chunk types.</p>
<p>This vignette assumes the knowledge found in the “Getting Started”
and “Advanced Usage” vignettes.</p>
</div>
<div class="section level2">
<h2 id="big-picture-how-qryflow-works">Big Picture: How <code>qryflow</code> Works<a class="anchor" aria-label="anchor" href="#big-picture-how-qryflow-works"></a>
</h2>
<p>When you run a SQL script using <code>qryflow</code>, the process
follows these steps:</p>
<ol style="list-style-type: decimal">
<li><p>Split the SQL script into chunks using tagged comments (e.g.,
<code>-- @query: name</code>)</p></li>
<li><p>Identify the type of each chunk</p></li>
<li><p>Parse each chunk into a structured object using a
<strong>type-specific parser</strong></p></li>
<li><p>Execute each chunk using a <strong>type-specific
handler</strong></p></li>
</ol>
<p>To support a new chunk type, you’ll need to:</p>
<ul>
<li><p><strong>Create a parser</strong> — which converts a chunk of raw
SQL into a structured <code>qryflow_chunk</code> object.</p></li>
<li><p><strong>Create a handler</strong> — which defines how to execute
the chunk and return results.</p></li>
<li><p><strong>Register</strong> your new type with <code>qryflow</code>
so the package knows how to process it.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="creating-parsers-and-handlers">Creating Parsers and Handlers<a class="anchor" aria-label="anchor" href="#creating-parsers-and-handlers"></a>
</h2>
<p>Each chunk type needs to have an associated parser and an associated
handler. This section outlines what arguments the custom parser and
handler functions need to accept, what operations they should perform,
and what results they should return.</p>
<div class="section level3">
<h3 id="parsers">Parsers<a class="anchor" aria-label="anchor" href="#parsers"></a>
</h3>
<p>The parser accepts the unaltered SQL statement of the chunk and
should return a formal <code>qryflow_chunk</code> object. Parsers will
only be executed on a single chunk at a time. The
<code>sqflow_chunk</code> object is essentially a list in the form
of:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="va">type</span>,</span>
<span>  name <span class="op">=</span> <span class="va">name</span>,</span>
<span>  sql <span class="op">=</span> <span class="va">sql</span>,</span>
<span>  tags <span class="op">=</span> <span class="va">tags</span>,</span>
<span>  results <span class="op">=</span> <span class="va">results</span> <span class="co"># Not populated until after execution</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The parser must extract the type, name, main SQL statement, and any
additional tags. The package provides some helpers to do this. As an
example, here is what the “exec” type parser looks like, with
informative comments:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qryflow_exec_parser</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># Get a character vector containing each line</span></span>
<span>  <span class="va">lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_sql_lines.html">read_sql_lines</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Identify any formal qryflow tags</span></span>
<span>  <span class="va">all_tags</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_all_tags.html">extract_all_tags</a></span><span class="op">(</span><span class="va">lines</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Check to see if an explicit name tag exists for the chunk</span></span>
<span>  <span class="va">name</span> <span class="op">&lt;-</span> <span class="va">all_tags</span><span class="op">$</span><span class="va">name</span></span>
<span></span>
<span>  <span class="co"># If an explicit name tag doesn't exist, use the value from the "exec" tag</span></span>
<span>  <span class="co"># This is how aliases are implemented</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">name</span> <span class="op">&lt;-</span> <span class="va">all_tags</span><span class="op">[[</span><span class="st">"exec"</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Find any additional tags beyond alias, name, or type</span></span>
<span>  <span class="va">tags</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_all_tags.html">subset_tags</a></span><span class="op">(</span><span class="va">all_tags</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"exec"</span>, <span class="st">"name"</span>, <span class="st">"type"</span><span class="op">)</span>, negate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Collapse the SQL into a single character</span></span>
<span>  <span class="va">sql_txt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/collapse_sql_lines.html">collapse_sql_lines</a></span><span class="op">(</span><span class="va">lines</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="../reference/is_tag_line.html">is_tag_line</a></span><span class="op">(</span><span class="va">lines</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Return the structured object</span></span>
<span>  <span class="fu"><a href="../reference/new_qryflow_chunk.html">new_qryflow_chunk</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"exec"</span>, name <span class="op">=</span> <span class="va">name</span>, sql <span class="op">=</span> <span class="va">sql_txt</span>, tags <span class="op">=</span> <span class="va">tags</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Note: The package includes helper functions like
<code><a href="../reference/read_sql_lines.html">read_sql_lines()</a></code>, <code><a href="../reference/extract_all_tags.html">extract_all_tags()</a></code>,
<code><a href="../reference/extract_all_tags.html">subset_tags()</a></code>, <code><a href="../reference/is_tag_line.html">is_tag_line()</a></code>, and others to
make parsing easier.</p>
</div>
<div class="section level3">
<h3 id="handlers">Handlers<a class="anchor" aria-label="anchor" href="#handlers"></a>
</h3>
<p>Handlers accepts both a <code>qryflow_chunk</code> object and a
database connection object (e.g., <code><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">DBI::dbConnect</a></code>). They
should execute the SQL as appropriate and then return the result:</p>
<p>This is the handler for the “exec” type:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qryflow_exec_handler</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">chunk</span>, <span class="va">con</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Pass the SQL of the chunk to desired execution strategy</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html" class="external-link">dbExecute</a></span><span class="op">(</span><span class="va">con</span>, <span class="va">chunk</span><span class="op">$</span><span class="va">sql</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Return the result</span></span>
<span>  <span class="va">result</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>After a custom parser and handler have been created, they need to be
registered.</p>
</div>
<div class="section level3">
<h3 id="validate-the-parser-and-handler">Validate the Parser and Handler<a class="anchor" aria-label="anchor" href="#validate-the-parser-and-handler"></a>
</h3>
<p><code>qryflow</code> provides two functions to test whether parser
and handler functions meet the specifications. An error will occur
if:</p>
<ul>
<li><p>The object is not a function</p></li>
<li><p>The formal arguments are not included</p></li>
<li><p>The formal arguments are not in the right order</p></li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/validate_qryflow_parser.html">validate_qryflow_parser</a></span><span class="op">(</span><span class="va">qryflow_exec_parser</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/validate_qryflow_handler.html">validate_qryflow_handler</a></span><span class="op">(</span><span class="va">qryflow_exec_handler</span><span class="op">)</span></span></code></pre></div>
<p>Note: These obviously do not test that the code within your function
is correct nor does it test what output each function is expected to
produce.</p>
</div>
</div>
<div class="section level2">
<h2 id="how-the-registry-works">How the Registry Works<a class="anchor" aria-label="anchor" href="#how-the-registry-works"></a>
</h2>
<p><code>qryflow</code> maintains two internal environments:</p>
<ul>
<li><p><code>.qryflow_parsers</code> for chunk parsers</p></li>
<li><p><code>.qryflow_handlers</code> for chunk handlers</p></li>
</ul>
<p>When the package is loaded, default types like “<code>query</code>”
and “<code>exec</code>” are automatically registered. You can register
additional types using:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Register separately</span></span>
<span><span class="fu"><a href="../reference/register_qryflow_type.html">register_qryflow_parser</a></span><span class="op">(</span><span class="st">"custom"</span>, <span class="va">my_custom_parser_func</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/register_qryflow_type.html">register_qryflow_handler</a></span><span class="op">(</span><span class="st">"custom"</span>, <span class="va">my_custom_handler_func</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or register both at once</span></span>
<span><span class="fu"><a href="../reference/register_qryflow_type.html">register_qryflow_type</a></span><span class="op">(</span></span>
<span>  <span class="st">"custom"</span>,</span>
<span>  parser <span class="op">=</span> <span class="va">my_custom_parser_func</span>,</span>
<span>  handler <span class="op">=</span> <span class="va">my_custom_handler_func</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can access what types are registered:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ls_qryflow_types.html">ls_qryflow_parsers</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ls_qryflow_types.html">ls_qryflow_handlers</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ls_qryflow_types.html">ls_qryflow_types</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Custom types must be re-registered each session. To make them
persistent, add registration calls to your <code>.Rprofile</code> (see:
<a href="https://docs.posit.co/ide/user/ide/guide/environments/r/managing-r.html" class="external-link">Managing
R Startup</a>), or create a small package with an <code>.onLoad()</code>
hook (see: <a href="https://r-pkgs.org/code.html#sec-code-onLoad-onAttach" class="external-link">R Packages
(2e)</a>).</p>
</div>
<div class="section level2">
<h2 id="toy-example-1-create-query-send-chunk-type">Toy Example #1: Create <code>query-send</code> Chunk Type<a class="anchor" aria-label="anchor" href="#toy-example-1-create-query-send-chunk-type"></a>
</h2>
<p>This example shows how to implement a new chunk type that’s similar
to <code>exec</code> and <code>query</code>. We will create a new type,
called <code>query-send</code> that works like <code>query</code> except
calls <code><a href="https://dbi.r-dbi.org/reference/dbSendQuery.html" class="external-link">DBI::dbSendQuery</a></code> instead of
<code><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">DBI::dbGetQuery</a></code>.</p>
<p>First, create the parser and handler:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">query_send_parser</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># Convert to individual lines</span></span>
<span>  <span class="va">lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_sql_lines.html">read_sql_lines</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">all_tags</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_all_tags.html">extract_all_tags</a></span><span class="op">(</span><span class="va">lines</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Check for explicit name</span></span>
<span>  <span class="va">name</span> <span class="op">&lt;-</span> <span class="va">all_tags</span><span class="op">$</span><span class="va">name</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Accomodate Aliased Approach</span></span>
<span>    <span class="va">name</span> <span class="op">&lt;-</span> <span class="va">all_tags</span><span class="op">[[</span><span class="st">"query-send"</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">other_tags</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_all_tags.html">subset_tags</a></span><span class="op">(</span><span class="va">all_tags</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"query-send"</span>, <span class="st">"name"</span>, <span class="st">"type"</span><span class="op">)</span>, negate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">sql_txt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">lines</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="../reference/is_tag_line.html">is_tag_line</a></span><span class="op">(</span><span class="va">lines</span><span class="op">)</span><span class="op">]</span>, collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/new_qryflow_chunk.html">new_qryflow_chunk</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"query-send"</span>, name <span class="op">=</span> <span class="va">name</span>, sql <span class="op">=</span> <span class="va">sql_txt</span>, tags <span class="op">=</span> <span class="va">other_tags</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">query_send_handler</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">chunk</span>, <span class="va">con</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbSendQuery.html" class="external-link">dbSendQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="va">chunk</span><span class="op">$</span><span class="va">sql</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbFetch.html" class="external-link">dbFetch</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbClearResult.html" class="external-link">dbClearResult</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">results</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Then, register them:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/register_qryflow_type.html">register_qryflow_type</a></span><span class="op">(</span></span>
<span>  <span class="st">"query-send"</span>,</span>
<span>  parser <span class="op">=</span> <span class="va">query_send_parser</span>,</span>
<span>  handler <span class="op">=</span> <span class="va">query_send_handler</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Check that they registered properly:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ls_qryflow_types.html">ls_qryflow_types</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "exec"       "query"      "query-send"</span></span></code></pre></div>
<p>And test it out on some SQL:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Creates an in-memory sqlite database and populates it with an mtcars table, named "mtcars" </span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/example_db_connect.html">example_db_connect</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create </span></span>
<span><span class="va">sql</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">-- @query-send: df_mtcars</span></span>
<span><span class="st">SELECT *</span></span>
<span><span class="st">FROM mtcars;</span></span>
<span><span class="st">"</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/qryflow.html">qryflow</a></span><span class="op">(</span><span class="va">sql</span>, <span class="va">con</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="co">#&gt;    mpg cyl disp  hp drat    wt  qsec vs am gear carb</span></span>
<span><span class="co">#&gt; 1 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4</span></span>
<span><span class="co">#&gt; 2 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4</span></span>
<span><span class="co">#&gt; 3 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1</span></span>
<span><span class="co">#&gt; 4 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</span></span>
<span><span class="co">#&gt; 5 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2</span></span>
<span><span class="co">#&gt; 6 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exercise-implement-an-include-chunk-type">Exercise: Implement an <code>include</code> Chunk Type<a class="anchor" aria-label="anchor" href="#exercise-implement-an-include-chunk-type"></a>
</h2>
<p>Want to try extending <code>qryflow</code> on your own?</p>
<p>Implement a custom “<code>include</code>” chunk type that loads SQL
from a separate file and injects it as a chunk.</p>
<p>For example, take the following statement:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co">-- @include: mysql.sql</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co">-- @query: my_df</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> <span class="kw">table</span></span></code></pre></div>
<p>Assuming <code>mysql.sql</code> contains:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co">-- @query: mysql</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">INTO</span> <span class="kw">table</span> <span class="kw">FROM</span> another_table</span></code></pre></div>
<p>How would you create the parser and handler so that functionally,
what gets returned is:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co">-- @query: mysql</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">INTO</span> <span class="kw">table</span> <span class="kw">FROM</span> another_table</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co">-- @query: my_df</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> <span class="kw">table</span></span></code></pre></div>
<p>A word of caution: this may be trickier than you think given how
chunks are currently implemented.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christian Million.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
